<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>超流體產生器參數計算</title>
    <style>
        :root {
            --bg-dark: #121212;
            --panel-bg: #1e1e1e;
            --accent-gold: #d4a017;
            --accent-cyan: #00d4ff;
            --text-main: #e0e0e0;
            --border-industrial: #333333;
            --input-focus: #444444;
            --danger: #ff4d4d;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Consolas', 'Segoe UI', 'Microsoft JhengHei', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .calc-wrapper {
            width: 100%;
            max-width: 600px;
            background: var(--panel-bg);
            border: 2px solid var(--border-industrial);
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .calc-wrapper::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: repeating-linear-gradient(
                45deg,
                var(--accent-gold),
                var(--accent-gold) 10px,
                #000 10px,
                #000 20px
            );
            z-index: 10;
        }

        /* 分頁標籤樣式 */
        .tabs {
            display: flex;
            background: #151515;
            border-bottom: 1px solid var(--border-industrial);
            padding-top: 4px;
        }

        .tab-btn {
            padding: 12px 20px;
            cursor: pointer;
            border: none;
            background: transparent;
            color: #666;
            font-family: inherit;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.85rem;
            transition: 0.3s;
        }

        .tab-btn.active {
            color: var(--accent-gold);
            background: var(--panel-bg);
            border-bottom: 2px solid var(--accent-gold);
        }

        .content-area {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        header {
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-industrial);
            padding-bottom: 15px;
        }

        h1 {
            font-size: 1.4rem;
            margin: 0;
            color: var(--accent-gold);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-tag {
            font-size: 0.7rem;
            background: #2a2a2a;
            padding: 2px 8px;
            border: 1px solid #444;
            display: inline-block;
            margin-top: 5px;
            color: #888;
        }

        .input-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .field {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 0.85rem;
            margin-bottom: 8px;
            color: #aaa;
        }

        input, select {
            background: #111;
            border: 1px solid var(--border-industrial);
            color: var(--accent-cyan);
            padding: 12px;
            font-size: 1rem;
            border-radius: 2px;
            outline: none;
            transition: all 0.3s;
        }

        input:focus, select:focus {
            border-color: var(--accent-gold);
            background: #1a1a1a;
        }

        .output-section {
            background: #151515;
            border: 1px solid #222;
            padding: 20px;
            position: relative;
        }

        .output-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #222;
        }

        .output-row:last-child {
            border-bottom: none;
        }

        .label-text {
            font-size: 0.9rem;
        }

        .value-text {
            color: var(--accent-gold);
            font-weight: bold;
            font-size: 1.1rem;
        }

        .unit {
            font-size: 0.8rem;
            color: #666;
            margin-left: 5px;
        }

        .warning-text {
            color: var(--danger);
            font-size: 0.8rem;
            display: none;
            margin-top: 10px;
            border-left: 2px solid var(--danger);
            padding-left: 10px;
        }

        .btn-calc {
            width: 100%;
            background: var(--accent-gold);
            color: #000;
            border: none;
            padding: 15px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            margin-top: 20px;
            letter-spacing: 2px;
            transition: 0.2s;
        }

        .btn-calc:hover {
            background: #f1b61c;
        }

        /* 說明分頁樣式 */
        .info-page h2 {
            color: var(--accent-gold);
            font-size: 1.1rem;
            margin-bottom: 15px;
            border-left: 3px solid var(--accent-gold);
            padding-left: 10px;
        }

        .info-card {
            background: #151515;
            border: 1px solid #222;
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-card strong {
            color: var(--danger);
            display: block;
            margin-bottom: 5px;
        }

        .formula-block {
            font-family: 'Consolas', monospace;
            background: #000;
            padding: 10px;
            color: var(--accent-cyan);
            font-size: 0.8rem;
            margin-top: 10px;
            border: 1px dashed #444;
        }

        .source-block {
            font-size: 0.75rem;
            color: #777;
            margin-top: 10px;
            font-style: italic;
        }

        .note {
            font-size: 0.75rem;
            color: #555;
            margin-top: 20px;
            line-height: 1.4;
        }
    </style>
</head>
<body>

<div class="calc-wrapper">
    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('calc')">Simulator</button>
        <button class="tab-btn" onclick="openTab('info')">Documentation</button>
    </div>

    <div class="content-area">
        <!-- 模擬器分頁 -->
        <div id="calc" class="tab-content active">
            <header>
                <h1>SUPER FLUID GENERATOR SIMULATOR V2.8</h1>
                <div class="status-tag">CREATOR: RANDY CHEN</div>
            </header>

            <div class="input-section">
                <div class="field" style="grid-column: span 2;">
                    <label>冷卻液種類 (Coolant Type)</label>
                    <select id="fluid_type">
                        <option value="synthetic_oil" selected>合成油 (Synthetic Oil) - 高黏度/高絕緣</option>
                        <option value="fluorinated">氟化液 (Fluorinated Fluid) - 電子級/低黏度</option>
                        <option value="pg25">PG25 (水基丙二醇) - 高比熱/導電風險</option>
                        <option value="pure_water">去離子純水 - 最高熱容/極高風險</option>
                    </select>
                </div>
                <div class="field">
                    <label>初始流體黏度 (Base Viscosity cP)</label>
                    <input type="number" id="base_visc" value="25.0" step="0.1">
                </div>
                <div class="field">
                    <label>氣泡注入體積比 (Injection Ratio %)</label>
                    <input type="number" id="inj_ratio" value="10.0" step="0.5" min="0" max="50">
                </div>
                <div class="field">
                    <label>冷卻液循環流速 (Flow Rate L/min)</label>
                    <input type="number" id="flow_rate" value="12.0" step="0.5">
                </div>
                <div class="field">
                    <label>運算節點 TDP (Target TDP Watts)</label>
                    <input type="number" id="target_tdp" value="1000" step="50">
                </div>
            </div>

            <div class="output-section">
                <div class="output-row">
                    <span class="label-text">流體黏度降低比例</span>
                    <span class="value-text" id="visc_red_out">--</span>
                </div>
                <div class="output-row">
                    <span class="label-text">預估熱阻值改善</span>
                    <span class="value-text" id="thermal_imp_out">--</span>
                </div>
                <div class="output-row">
                    <span class="label-text">流體熱容衰減 (Capacity Loss)</span>
                    <span class="value-text" style="color: #ff4d4d;" id="heat_loss_out">--</span>
                </div>
                <div class="output-row">
                    <span class="label-text">系統最終解熱能力</span>
                    <span class="value-text" id="cool_capacity_out">--</span>
                </div>
                <div id="warning_box" class="warning-text">
                    WARNING: 氣泡比例過高，熱容衰減已抵銷散熱增益。
                </div>
            </div>

            <button class="btn-calc" id="run_sim">執行參數演算</button>
        </div>

        <!-- 說明分頁 -->
        <div id="info" class="tab-content info-page">
            <header>
                <h1>物理極限與演算公式說明</h1>
                <div class="status-tag">TECHNICAL DATA SHEET</div>
            </header>

            <div class="info-card">
                <h2>演算公式核心 (Algorithm Formulas)</h2>
                <p style="font-size: 0.85rem; line-height: 1.6;">
                    系統根據輸入之流體特性與注入比進行非線性模擬：
                </p>
                <div class="formula-block">
                    1. 黏度降低比例 (Viscosity Reduction):<br>
                    &nbsp;&nbsp;If Ratio ≤ 18%: Reduction = Ratio * 1.35 * ViscGain<br>
                    &nbsp;&nbsp;Else: 18% Gain + (Ratio - 18) * 0.35<br><br>
                    2. 熱阻改善 (Thermal Improvement):<br>
                    &nbsp;&nbsp;Base: 8.8 + (Ratio / 25) * (11.4 - 8.8)<br><br>
                    3. 熱容衰減 (Capacity Loss):<br>
                    &nbsp;&nbsp;Loss = Ratio * (0.7 + (HeatWeight * 0.3))
                </div>
                <div class="source-block">
                    公式來源：參考「多相流解熱效率實驗模型 (Multiphase Flow Cooling Efficiency Empirical Model)」及內部氣泡輔助流動研究數據。
                </div>
            </div>

            <div class="info-card">
                <h2>熱容 (Specific Heat Capacity) 下降</h2>
                <p style="font-size: 0.85rem; line-height: 1.6;">
                    空氣的比熱遠低於液體。當體積比達到 40% 時，流體單位體積能攜帶的熱量會大幅減少，導致即使流速加快，整體換熱效率依然下降。
                </p>
            </div>

            <div class="info-card">
                <h2>幫浦空蝕 (Cavitation) 風險</h2>
                <p style="font-size: 0.85rem; line-height: 1.6;">
                    過多氣泡注入會導致幫浦葉片處產生氣阻或空蝕現象，導致幫浦效能下降、震動增加，甚至造成物理性損壞。
                </p>
            </div>

            <div class="note" style="color: var(--accent-gold); border-top: 1px solid #333; padding-top: 15px;">
                建議最佳運行區間：10.0% ~ 18.0% 氣泡注入比。系統於超過 25% 時將發出物理性效能崩潰預警。
            </div>
        </div>
    </div>
</div>

<script>
    // 禁用右鍵選單
    document.addEventListener('contextmenu', e => e.preventDefault());

    // 分頁切換功能
    function openTab(tabName) {
        const contents = document.getElementsByClassName('tab-content');
        const buttons = document.getElementsByClassName('tab-btn');
        
        for (let content of contents) content.classList.remove('active');
        for (let btn of buttons) btn.classList.remove('active');
        
        document.getElementById(tabName).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // 根據冷卻液種類自動調整預設黏度
    document.getElementById('fluid_type').addEventListener('change', function() {
        const baseVisc = document.getElementById('base_visc');
        switch(this.value) {
            case 'synthetic_oil': baseVisc.value = 25.0; break;
            case 'fluorinated': baseVisc.value = 0.8; break;
            case 'pg25': baseVisc.value = 2.5; break;
            case 'pure_water': baseVisc.value = 1.0; break;
        }
    });

    function performCalculation() {
        const fluidType = document.getElementById('fluid_type').value;
        const baseVisc = parseFloat(document.getElementById('base_visc').value);
        const ratio = parseFloat(document.getElementById('inj_ratio').value);
        const flow = parseFloat(document.getElementById('flow_rate').value);
        const tdp = parseFloat(document.getElementById('target_tdp').value);

        if (isNaN(baseVisc) || isNaN(ratio) || isNaN(flow) || isNaN(tdp)) return;

        // 流體物理參數配置表
        const fluidProps = {
            'synthetic_oil': { heatWeight: 0.45, viscGain: 1.5 },
            'fluorinated':   { heatWeight: 0.25, viscGain: 0.8 },
            'pg25':          { heatWeight: 0.85, viscGain: 1.0 },
            'pure_water':    { heatWeight: 1.00, viscGain: 1.1 }
        };
        const currentProp = fluidProps[fluidType];

        // 1. 黏度降低演算 (帶非線性飽和效應)
        let viscReduction = ratio * 1.35 * currentProp.viscGain;
        if (ratio > 18) {
            viscReduction = (18 * 1.35 * currentProp.viscGain) + (ratio - 18) * 0.35;
        }
        if (viscReduction > 45) viscReduction = 45;

        // 2. 熱阻改善演算 (邊際效益遞減)
        let thermalImp = 8.8 + (ratio / 25) * (11.4 - 8.8);
        if (ratio < 5) thermalImp = (ratio / 5) * 8.8;
        if (fluidType === 'fluorinated') thermalImp *= 0.7;

        // 3. 熱容衰減演算 (隨氣泡比例增加)
        let heatCapacityLoss = ratio * (0.7 + (currentProp.heatWeight * 0.3)); 

        // 4. 系統最終效能計算
        let netGain = (1 + (thermalImp / 100)) * (1 - (heatCapacityLoss / 100));
        let finalCapacity = tdp * netGain;

        document.getElementById('visc_red_out').innerHTML = viscReduction.toFixed(2) + '<span class="unit">%</span>';
        document.getElementById('thermal_imp_out').innerHTML = thermalImp.toFixed(2) + '<span class="unit">%</span>';
        document.getElementById('heat_loss_out').innerHTML = heatCapacityLoss.toFixed(2) + '<span class="unit">%</span>';
        document.getElementById('cool_capacity_out').innerHTML = Math.round(finalCapacity) + '<span class="unit">W</span>';

        // 預警判斷
        const warningBox = document.getElementById('warning_box');
        if (netGain < 0.95 || ratio > 25) {
            warningBox.style.display = 'block';
        } else {
            warningBox.style.display = 'none';
        }
    }

    document.getElementById('run_sim').addEventListener('click', performCalculation);
    window.onload = performCalculation;
</script>

</body>
</html>
